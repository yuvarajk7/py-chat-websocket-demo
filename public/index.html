<!DOCTYPE html>
<html>
<head>
    <title>FastAPI WebSocket Chat</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        body { background-color: #f8f9fa; }
        .chat-container { height: 100vh; }
        .sidebar { background-color: #343a40; color: white; height: 100vh; overflow-y: auto; }
        .main-chat { height: 100vh; display: flex; flex-direction: column; }
        .chat-header { background-color: #495057; color: white; padding: 1rem; }
        .messages-container { flex: 1; overflow-y: auto; padding: 1rem; background-color: white; }
        #messages { list-style-type: none; margin: 0; padding: 0; }
        #messages li { padding: 8px 12px; margin-bottom: 5px; border-radius: 8px; }
        #messages li:nth-child(odd) { background: #f8f9fa; }
        .system-message { color: #6c757d; font-style: italic; background: #e9ecef !important; }
        .message-input { padding: 1rem; background-color: #f8f9fa; border-top: 1px solid #dee2e6; }
        .room-item { cursor: pointer; padding: 0.75rem 1rem; border-radius: 0.375rem; margin-bottom: 0.25rem; transition: background-color 0.2s; }
        .room-item:hover { background-color: #495057; }
        .room-item.active { background-color: #0d6efd; }
        .room-list { max-height: 300px; overflow-y: auto; }
        .user-count { font-size: 0.8em; color: #adb5bd; }
        .login-container { min-height: 100vh; display: flex; align-items: center; justify-content: center; }
        .login-card { max-width: 400px; width: 100%; }
        .sidebar-header { padding: 1rem; border-bottom: 1px solid #495057; }
        .create-room-form { padding: 1rem; border-bottom: 1px solid #495057; }
    </style>
</head>
<body>
    <!-- Login/Register View -->
    <div id="login-view" class="login-container">
        <div class="login-card">
            <div class="card shadow">
                <div class="card-body p-4">
                    <!-- Login Form -->
                    <div id="login-form">
                        <h2 class="card-title text-center mb-4">
                            <i class="bi bi-chat-dots"></i> Login to Chat
                        </h2>
                        <form onsubmit="login(); return false;">
                            <div class="mb-3">
                                <label for="login-username" class="form-label">Username</label>
                                <input type="text" class="form-control" id="login-username" placeholder="Enter your username" required>
                            </div>
                            <div class="mb-3">
                                <label for="login-password" class="form-label">Password</label>
                                <input type="password" class="form-control" id="login-password" placeholder="Enter your password" required>
                            </div>
                            <button type="submit" class="btn btn-primary w-100 mb-3">
                                <i class="bi bi-box-arrow-in-right"></i> Login
                            </button>
                        </form>
                        <div class="text-center">
                            <small class="text-muted">
                                Don't have an account?
                                <a href="#" onclick="showRegisterForm()" class="text-decoration-none">Register here</a>
                            </small>
                        </div>
                        <div id="login-error" class="text-danger mt-2"></div>
                    </div>

                    <!-- Register Form -->
                    <div id="register-form" class="d-none">
                        <h2 class="card-title text-center mb-4">
                            <i class="bi bi-person-plus"></i> Create Account
                        </h2>
                        <form onsubmit="register(); return false;">
                            <div class="mb-3">
                                <label for="register-username" class="form-label">Username</label>
                                <input type="text" class="form-control" id="register-username" placeholder="Choose a username" required>
                            </div>
                            <div class="mb-3">
                                <label for="register-email" class="form-label">Email</label>
                                <input type="email" class="form-control" id="register-email" placeholder="Enter your email" required>
                            </div>
                            <div class="mb-3">
                                <label for="register-fullname" class="form-label">Full Name (Optional)</label>
                                <input type="text" class="form-control" id="register-fullname" placeholder="Enter your full name">
                            </div>
                            <div class="mb-3">
                                <label for="register-password" class="form-label">Password</label>
                                <input type="password" class="form-control" id="register-password" placeholder="Choose a password" required>
                            </div>
                            <div class="mb-3">
                                <label for="register-confirm-password" class="form-label">Confirm Password</label>
                                <input type="password" class="form-control" id="register-confirm-password" placeholder="Confirm your password" required>
                            </div>
                            <button type="submit" class="btn btn-success w-100 mb-3">
                                <i class="bi bi-person-plus"></i> Create Account
                            </button>
                        </form>
                        <div class="text-center">
                            <small class="text-muted">
                                Already have an account?
                                <a href="#" onclick="showLoginForm()" class="text-decoration-none">Login here</a>
                            </small>
                        </div>
                        <div id="register-error" class="text-danger mt-2"></div>
                        <div id="register-success" class="text-success mt-2"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Chat View -->
    <div id="chat-view" class="d-none">
        <div class="container-fluid chat-container">
            <div class="row h-100">
                <!-- Sidebar -->
                <div class="col-md-3 sidebar p-0">
                    <div class="sidebar-header">
                        <h5 class="mb-1">
                            <i class="bi bi-person-circle"></i> <span id="welcome-user"></span>
                        </h5>
                        <small class="text-muted">Online</small>
                    </div>

                    <!-- Create Room Form -->
                    <div class="create-room-form">
                        <h6 class="mb-2">
                            <i class="bi bi-plus-circle"></i> Create Room
                        </h6>
                        <div class="input-group input-group-sm">
                            <input type="text" class="form-control" id="new-room-name" placeholder="Room name">
                            <button class="btn btn-outline-light" onclick="createRoom()">
                                <i class="bi bi-plus"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Room List -->
                    <div class="p-3">
                        <h6 class="mb-3">
                            <i class="bi bi-door-open"></i> Rooms
                        </h6>
                        <div id="room-list" class="room-list">
                            <!-- Rooms will be populated here -->
                        </div>
                    </div>
                </div>

                <!-- Main Chat Area -->
                <div class="col-md-9 p-0 main-chat">
                    <!-- Chat Header -->
                    <div class="chat-header">
                        <h5 class="mb-1">
                            <i class="bi bi-hash"></i> <span id="welcome-room"></span>
                        </h5>
                        <small>
                            <i class="bi bi-people"></i>
                            Users: <span id="user-list">Loading...</span>
                        </small>
                    </div>

                    <!-- Messages Container -->
                    <div class="messages-container">
                        <ul id="messages"></ul>
                    </div>

                    <!-- Message Input -->
                    <div class="message-input">
                        <div class="input-group">
                            <input type="text" id="messageText" class="form-control" autocomplete="off" placeholder="Type a message..."/>
                            <button onclick="sendMessage()" class="btn btn-primary">
                                <i class="bi bi-send"></i> Send
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="/chat.js?v=2"></script>
</body>
</html>
